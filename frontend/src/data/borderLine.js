/**
 * Border Line Data - ‡πÄ‡∏™‡πâ‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÑ‡∏ó‡∏¢-‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤
 * 
 * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì:
 * - ‡∏ö‡πà‡∏≠‡πÑ‡∏£‡πà/‡∏ä‡∏≥‡∏£‡∏≤‡∏Å (‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏°‡∏≤‡∏Å)
 * - ‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà/‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å
 * - ‡πÄ‡∏Ç‡∏ï‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡∏à.‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ
 * 
 * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
 */

/**
 * ‡πÄ‡∏™‡πâ‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÑ‡∏ó‡∏¢-‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤ (‡∏à.‡∏ï‡∏£‡∏≤‡∏î + ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
 * 
 * ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ï‡πâ (‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å) ‡πÑ‡∏õ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (‡∏à.‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ)
 * ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á
 */
export const TRAT_BORDER_POINTS = [
  // ======================================
  // ‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ: ‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å + ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏ó‡∏∞‡πÄ‡∏•
  // ======================================
  { lat: 11.545, lng: 102.912, name: '‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏ó‡∏∞‡πÄ‡∏• (‡πÉ‡∏ï‡πâ‡∏™‡∏∏‡∏î)' },
  { lat: 11.580, lng: 102.910, name: '‡∏≠‡πà‡∏≤‡∏ß‡∏ï‡∏£‡∏≤‡∏î' },
  { lat: 11.620, lng: 102.908, name: '‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡πÉ‡∏ï‡πâ' },
  { lat: 11.660, lng: 102.906, name: '‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å' },
  { lat: 11.678, lng: 102.906, name: '‡∏î‡πà‡∏≤‡∏ô‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á)' },
  { lat: 11.700, lng: 102.905, name: '‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å' },
  
  // ======================================
  // ‡∏≠.‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà - ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤
  // ======================================
  { lat: 11.730, lng: 102.898, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ï‡πâ' },
  { lat: 11.760, lng: 102.892, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏•‡∏≤‡∏á' },
  { lat: 11.790, lng: 102.885, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏∞‡∏Ç‡∏≤‡∏°' },
  { lat: 11.820, lng: 102.878, name: '‡πÄ‡∏Ç‡∏≤‡∏™‡∏±‡∏ô‡∏´‡∏ô‡∏≠‡∏Å' },
  { lat: 11.850, lng: 102.872, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏°‡∏∞‡∏Ç‡∏≤‡∏°' },
  { lat: 11.880, lng: 102.865, name: '‡πÄ‡∏Ç‡∏≤‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å' },
  { lat: 11.910, lng: 102.858, name: '‡πÑ‡∏°‡πâ‡∏£‡∏π‡∏î' },
  { lat: 11.940, lng: 102.852, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏≠‡∏ô' },
  { lat: 11.970, lng: 102.845, name: '‡πÄ‡∏Ç‡∏ï‡∏ï‡πà‡∏≠‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà-‡∏ö‡πà‡∏≠‡πÑ‡∏£‡πà' },
  
  // ======================================
  // ‚ö†Ô∏è ‡∏≠.‡∏ö‡πà‡∏≠‡πÑ‡∏£‡πà - ‡∏ä‡∏≥‡∏£‡∏≤‡∏Å (‡πÉ‡∏Å‡∏•‡πâ‡∏ê‡∏≤‡∏ô‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤‡∏°‡∏≤‡∏Å!)
  // ‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  // ======================================
  { lat: 12.000, lng: 102.780, name: '‡∏ö‡πà‡∏≠‡πÑ‡∏£‡πà‡πÉ‡∏ï‡πâ' },
  { lat: 12.020, lng: 102.775, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≤‡∏ß' },
  { lat: 12.040, lng: 102.770, name: '‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤‡∏û‡∏•‡∏π' },
  { lat: 12.060, lng: 102.760, name: '‡πÄ‡∏Ç‡∏≤‡∏û‡∏•‡∏π' },
  { lat: 12.080, lng: 102.750, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô' },
  
  // ‚ö†Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏≤‡∏Å - ‡∏ê‡∏≤‡∏ô‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏≤! (‡πÉ‡∏Å‡∏•‡πâ‡∏°‡∏≤‡∏Å)
  { lat: 12.100, lng: 102.740, name: '‡∏ä‡∏≥‡∏£‡∏≤‡∏Å ‡πÉ‡∏ï‡πâ' },
  { lat: 12.120, lng: 102.730, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≥‡∏£‡∏≤‡∏Å' },
  { lat: 12.140, lng: 102.720, name: '‡πÄ‡∏Ç‡∏≤‡∏ä‡∏≥‡∏£‡∏≤‡∏Å (‡∏ê‡∏≤‡∏ô‡∏Å‡∏±‡∏°‡∏û‡∏π‡∏ä‡∏≤‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏≤!)' },
  { lat: 12.160, lng: 102.715, name: '‡∏ä‡∏≥‡∏£‡∏≤‡∏Å ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠' },
  { lat: 12.180, lng: 102.710, name: '‡∏™‡∏±‡∏ô‡πÄ‡∏Ç‡∏≤‡∏ä‡∏≥‡∏£‡∏≤‡∏Å' },
  { lat: 12.200, lng: 102.705, name: '‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤‡∏ä‡∏≥‡∏£‡∏≤‡∏Å' },
  
  // ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠
  { lat: 12.220, lng: 102.700, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤' },
  { lat: 12.250, lng: 102.695, name: '‡∏Å‡∏£‡∏∞‡πÅ‡∏à‡∏∞' },
  { lat: 12.280, lng: 102.690, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠' },
  { lat: 12.310, lng: 102.685, name: '‡πÄ‡∏Ç‡∏≤‡∏™‡∏≤‡∏°‡∏ä‡∏±‡πâ‡∏ô' },
  { lat: 12.340, lng: 102.680, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏Å‡∏Å' },
  
  // ======================================
  // ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô ‡∏≠.‡πÄ‡∏Ç‡∏≤‡∏™‡∏°‡∏¥‡∏á + ‡∏ï‡πà‡∏≠ ‡∏à.‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ
  // ======================================
  { lat: 12.350, lng: 102.748, name: '‡πÄ‡∏Ç‡∏≤‡∏™‡∏°‡∏¥‡∏á‡πÉ‡∏ï‡πâ' },
  { lat: 12.380, lng: 102.740, name: '‡πÄ‡∏Ç‡∏≤‡∏ß‡∏±‡∏á‡∏ú‡∏≤' },
  { lat: 12.410, lng: 102.732, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡πà‡∏≤‡πÇ‡∏™‡∏°' },
  { lat: 12.440, lng: 102.724, name: '‡∏Ñ‡∏•‡∏≠‡∏á‡∏Å‡∏ß‡∏≤‡∏á' },
  { lat: 12.470, lng: 102.716, name: '‡πÄ‡∏Ç‡∏≤‡∏™‡∏≠‡∏¢‡∏î‡∏≤‡∏ß' },
  { lat: 12.500, lng: 102.708, name: '‡πÄ‡∏Ç‡∏ï‡∏ï‡∏£‡∏≤‡∏î-‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ' },
  
  // ======================================
  // ‡∏à.‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ (‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
  // ======================================
  { lat: 12.530, lng: 102.700, name: '‡πÇ‡∏õ‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏£‡πâ‡∏≠‡∏ô' },
  { lat: 12.560, lng: 102.690, name: '‡∏ó‡∏±‡∏ö‡πÑ‡∏ó‡∏£' },
  { lat: 12.590, lng: 102.680, name: '‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏∏‡πà‡∏°' },
  { lat: 12.620, lng: 102.670, name: '‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏´‡∏•‡∏°' },
  { lat: 12.650, lng: 102.660, name: '‡∏õ‡∏∞‡∏ï‡∏á' },
  { lat: 12.680, lng: 102.650, name: '‡∏™‡∏≠‡∏¢‡∏î‡∏≤‡∏ß' },
  { lat: 12.710, lng: 102.640, name: '‡∏ó‡∏∏‡πà‡∏á‡πÄ‡∏ö‡∏ç‡∏à‡∏≤' },
  
  // ======================================
  // ‡∏ï‡πà‡∏≠ ‡∏à.‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß
  // ======================================
  { lat: 12.750, lng: 102.630, name: '‡πÇ‡∏Ñ‡∏Å‡∏™‡∏π‡∏á' },
  { lat: 12.800, lng: 102.620, name: '‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡πÉ‡∏ï‡πâ' },
  { lat: 12.850, lng: 102.610, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏•‡∏≠‡∏á‡∏•‡∏∂‡∏Å' },
  { lat: 12.900, lng: 102.600, name: '‡∏î‡πà‡∏≤‡∏ô‡∏≠‡∏£‡∏±‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®' },
  
  // ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß-‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå)
  { lat: 13.000, lng: 102.580, name: '‡∏ï‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤' },
  { lat: 13.100, lng: 102.570, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏£‡∏π‡∏î' },
  { lat: 13.200, lng: 102.560, name: '‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏°' },
  { lat: 13.300, lng: 102.570, name: '‡∏î‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏°' },
  { lat: 13.400, lng: 102.590, name: '‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏°‡πá‡∏Å' },
  
  // ‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå-‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå
  { lat: 13.500, lng: 102.650, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏£‡∏ß‡∏î' },
  { lat: 13.600, lng: 102.750, name: '‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏≠‡∏ö‡∏Å' },
  { lat: 13.700, lng: 102.900, name: '‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏∞‡∏á‡∏≥' },
  { lat: 13.800, lng: 103.100, name: '‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå' },
  { lat: 13.900, lng: 103.400, name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏ï‡∏∞‡πÇ‡∏Å' },
  
  // ‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå-‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©
  { lat: 14.000, lng: 103.600, name: '‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏∞‡∏û‡∏∑‡∏≠' },
  { lat: 14.100, lng: 103.900, name: '‡∏†‡∏π‡∏°‡∏¥‡∏ã‡∏£‡∏≠‡∏•' },
  { lat: 14.200, lng: 104.200, name: '‡πÄ‡∏Ç‡∏≤‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏´‡∏≤‡∏£' },
  { lat: 14.300, lng: 104.500, name: '‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏°‡πá‡∏Å' },
  
  // ‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ
  { lat: 14.400, lng: 104.800, name: '‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏°‡πá‡∏Å/‡∏≠‡∏∏‡∏ö‡∏•' },
  { lat: 14.500, lng: 105.000, name: '‡∏ö‡∏∏‡∏ì‡∏ë‡∏£‡∏¥‡∏Å' },
  { lat: 14.600, lng: 105.200, name: '‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏ô‡∏°‡πâ‡∏≤' },
]

/**
 * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏á‡∏à‡∏∏‡∏î (Haversine Formula)
 */
export const haversineDistance = (lat1, lng1, lat2, lng2) => {
  const R = 6371
  const dLat = ((lat2 - lat1) * Math.PI) / 180
  const dLng = ((lng2 - lng1) * Math.PI) / 180
  const a = 
    Math.sin(dLat / 2) ** 2 +
    Math.cos((lat1 * Math.PI) / 180) * 
    Math.cos((lat2 * Math.PI) / 180) * 
    Math.sin(dLng / 2) ** 2
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
}

/**
 * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á line segment (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡∏à‡∏∏‡∏î)
 * ‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏à‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏à‡∏∏‡∏î
 */
const pointToSegmentDistance = (lat, lng, lat1, lng1, lat2, lng2) => {
  // Convert to radians and project
  const R = 6371
  const toRad = d => d * Math.PI / 180
  
  // Vector from point 1 to point
  const dx = (lng - lng1) * Math.cos(toRad((lat1 + lat) / 2))
  const dy = lat - lat1
  
  // Vector from point 1 to point 2
  const dx2 = (lng2 - lng1) * Math.cos(toRad((lat1 + lat2) / 2))
  const dy2 = lat2 - lat1
  
  // Calculate projection
  const segLengthSq = dx2 * dx2 + dy2 * dy2
  
  if (segLengthSq === 0) {
    // Segment is a point
    return haversineDistance(lat, lng, lat1, lng1)
  }
  
  // Clamp t to [0, 1]
  let t = ((dx * dx2) + (dy * dy2)) / segLengthSq
  t = Math.max(0, Math.min(1, t))
  
  // Find closest point on segment
  const closestLng = lng1 + t * (lng2 - lng1)
  const closestLat = lat1 + t * (lat2 - lat1)
  
  return haversineDistance(lat, lng, closestLat, closestLng)
}

/**
 * ‡∏´‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
 * ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏õ segment ‡πÅ‡∏ó‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
 */
export const getDistanceToBorder = (lat, lng) => {
  let minDistance = Infinity
  let nearestPoint = null

  // ‡∏ß‡∏ô‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞ segment
  for (let i = 0; i < TRAT_BORDER_POINTS.length - 1; i++) {
    const p1 = TRAT_BORDER_POINTS[i]
    const p2 = TRAT_BORDER_POINTS[i + 1]
    
    const dist = pointToSegmentDistance(
      lat, lng, 
      p1.lat, p1.lng, 
      p2.lat, p2.lng
    )
    
    if (dist < minDistance) {
      minDistance = dist
      nearestPoint = dist < haversineDistance(lat, lng, p1.lat, p1.lng) 
        ? p2 
        : p1
    }
  }

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢
  const lastPoint = TRAT_BORDER_POINTS[TRAT_BORDER_POINTS.length - 1]
  const lastDist = haversineDistance(lat, lng, lastPoint.lat, lastPoint.lng)
  if (lastDist < minDistance) {
    minDistance = lastDist
    nearestPoint = lastPoint
  }

  return {
    distance: Math.round(minDistance * 100) / 100, // 2 decimal
    distanceRounded: Math.round(minDistance),
    nearestPoint
  }
}

/**
 * ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
 */
export const getDistanceLevel = (distanceKm) => {
  if (distanceKm <= 5) {
    return { 
      level: 'CRITICAL', 
      color: '#991b1b', 
      bgColor: '#fee2e2',
      emoji: 'üö®',
      text: '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï - ‡πÉ‡∏Å‡∏•‡πâ‡∏°‡∏≤‡∏Å!',
      description: '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 5 ‡∏Å‡∏°. ‡∏à‡∏≤‡∏Å‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô'
    }
  }
  if (distanceKm <= 15) {
    return { 
      level: 'VERY_CLOSE', 
      color: '#dc2626', 
      bgColor: '#fecaca',
      emoji: 'üî¥',
      text: '‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏°‡∏≤‡∏Å',
      description: '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 5-15 ‡∏Å‡∏°. (‡∏£‡∏∞‡∏¢‡∏∞‡∏õ‡∏∑‡∏ô‡πÉ‡∏´‡∏ç‡πà)'
    }
  }
  if (distanceKm <= 25) {
    return { 
      level: 'CLOSE', 
      color: '#ea580c', 
      bgColor: '#fed7aa',
      emoji: 'üü†',
      text: '‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô',
      description: '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 15-25 ‡∏Å‡∏°.'
    }
  }
  if (distanceKm <= 52) {
    return { 
      level: 'BM21_RANGE', 
      color: '#f59e0b', 
      bgColor: '#fef3c7',
      emoji: 'üü°',
      text: '‡∏£‡∏∞‡∏¢‡∏∞ BM-21',
      description: '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 25-52 ‡∏Å‡∏°. (‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏£‡∏ß‡∏î BM-21)'
    }
  }
  if (distanceKm <= 130) {
    return { 
      level: 'PHL03_RANGE', 
      color: '#84cc16', 
      bgColor: '#ecfccb',
      emoji: 'üü¢',
      text: '‡∏£‡∏∞‡∏¢‡∏∞ PHL-03',
      description: '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 52-130 ‡∏Å‡∏°. (‡∏£‡∏∞‡∏¢‡∏∞ PHL-03)'
    }
  }
  return { 
    level: 'SAFE', 
    color: '#22c55e', 
    bgColor: '#dcfce7',
    emoji: '‚úÖ',
    text: '‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò',
    description: '‡∏≠‡∏¢‡∏π‡πà‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏¢‡∏¥‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 130 ‡∏Å‡∏°.'
  }
}

/**
 * ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
 */
export const findNearestBorderPoint = (lat, lng) => {
  let minDist = Infinity
  let nearest = null
  
  TRAT_BORDER_POINTS.forEach(point => {
    const dist = haversineDistance(lat, lng, point.lat, point.lng)
    if (dist < minDist) {
      minDist = dist
      nearest = { ...point, distance: dist }
    }
  })
  
  return nearest
}

export default {
  TRAT_BORDER_POINTS,
  haversineDistance,
  getDistanceToBorder,
  getDistanceLevel,
  findNearestBorderPoint
}
