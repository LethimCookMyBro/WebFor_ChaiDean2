/**
 * ข้อมูลตำบลจังหวัดตราด (Trat Province Sub-districts)
 * 
 * พิกัดจริงจากแหล่งข้อมูลทางราชการและ Wikipedia
 * ใช้เป็นจุดศูนย์กลางของแต่ละตำบล
 */

// ข้อมูลตำบลแยกตามอำเภอ พร้อมพิกัด GPS
export const TRAT_TAMBONS = {
  // ============================================
  // อำเภอเมืองตราด (Mueang Trat) - 14 ตำบล
  // ============================================
  'เมืองตราด': {
    'บางพระ': { lat: 12.2317, lng: 102.5133, isCenter: true },
    'วังกระแจะ': { lat: 12.2436, lng: 102.5151 },
    'ตะกาง': { lat: 12.2089, lng: 102.4889 },
    'ชำราก': { lat: 12.2672, lng: 102.4856 },
    'ท่าพริก': { lat: 12.3125, lng: 102.5423 },
    'เนินทราย': { lat: 12.2756, lng: 102.5678 },
    'หนองเสม็ด': { lat: 12.2123, lng: 102.5116 },
    'หนองโสน': { lat: 12.1700, lng: 102.4700 },
    'หนองคันทรง': { lat: 12.2001, lng: 102.5489 },
    'ห้วงน้ำขาว': { lat: 12.1456, lng: 102.5234 },
    'อ่าวใหญ่': { lat: 12.1070, lng: 102.4700 },
    'ห้วยแร้ง': { lat: 12.2934, lng: 102.5891 },
    'ท่ากุ่ม': { lat: 12.3056, lng: 102.5234 },
    'แหลมกลัด': { lat: 12.1040, lng: 102.5350 },
  },

  // ============================================
  // อำเภอคลองใหญ่ (Khlong Yai) - 3 ตำบล
  // ชายแดนไทย-กัมพูชา - พื้นที่เสี่ยงสูงสุด
  // ============================================
  'คลองใหญ่': {
    'คลองใหญ่': { lat: 11.7767, lng: 102.8867, isCenter: true },
    'หาดเล็ก': { lat: 11.6506, lng: 102.9100 }, // ด่านชายแดน - อันตรายสูงสุด
    'ไม้รูด': { lat: 11.8970, lng: 102.8100 },
  },

  // ============================================
  // อำเภอเขาสมิง (Khao Saming) - 8 ตำบล
  // ============================================
  'เขาสมิง': {
    'เขาสมิง': { lat: 12.4000, lng: 102.6500, isCenter: true },
    'ท่าโสม': { lat: 12.3756, lng: 102.6234 },
    'ประณีต': { lat: 12.4234, lng: 102.6789 },
    'วังตะเคียน': { lat: 12.4456, lng: 102.7012 },
    'สะตอ': { lat: 12.3891, lng: 102.7234 },
    'ทุ่งนนทรี': { lat: 12.4123, lng: 102.5891 },
    'เทพนิมิต': { lat: 12.4567, lng: 102.6123 },
    'แสนตุ้ง': { lat: 12.3678, lng: 102.6567 },
  },

  // ============================================
  // อำเภอบ่อไร่ (Bo Rai) - 4 ตำบล
  // ติดชายแดน - พื้นที่เสี่ยง
  // ============================================
  'บ่อไร่': {
    'บ่อพลอย': { lat: 12.3833, lng: 102.8000, isCenter: true },
    'ช้างทูน': { lat: 12.4123, lng: 102.8234 },
    'ด่านชุมพล': { lat: 12.3130, lng: 102.8490 }, // ด่านชายแดน
    'หนองบอน': { lat: 12.3678, lng: 102.7789 },
  },

  // ============================================
  // อำเภอแหลมงอบ (Laem Ngop) - 4 ตำบล
  // ============================================
  'แหลมงอบ': {
    'แหลมงอบ': { lat: 12.1833, lng: 102.3833, isCenter: true },
    'น้ำเชี่ยว': { lat: 12.2012, lng: 102.4056 },
    'บางปิด': { lat: 12.1567, lng: 102.3567 },
    'บางกระดาน': { lat: 12.1234, lng: 102.3234 },
  },

  // ============================================
  // อำเภอเกาะกูด (Ko Kut) - 2 ตำบล
  // เกาะ - ปลอดภัย
  // ============================================
  'เกาะกูด': {
    'เกาะกูด': { lat: 11.6500, lng: 102.5667, isCenter: true },
    'เกาะหมาก': { lat: 11.8167, lng: 102.4667 },
  },

  // ============================================
  // อำเภอเกาะช้าง (Ko Chang) - 2 ตำบล
  // เกาะ - ปลอดภัย
  // ============================================
  'เกาะช้าง': {
    'เกาะช้าง': { lat: 12.0500, lng: 102.3500, isCenter: true },
    'เกาะช้างใต้': { lat: 11.9833, lng: 102.3667 },
  },
}

// สร้าง flat list สำหรับง่ายต่อการใช้งาน
export const getAllTambons = () => {
  const result = []
  Object.entries(TRAT_TAMBONS).forEach(([amphoe, tambons]) => {
    Object.entries(tambons).forEach(([tambon, coords]) => {
      result.push({
        amphoe,
        tambon,
        fullName: `ต.${tambon} อ.${amphoe}`,
        ...coords
      })
    })
  })
  return result
}

// ค้นหาตำบลที่ใกล้ที่สุดจากพิกัด GPS
export const findNearestTambon = (lat, lng) => {
  const tambons = getAllTambons()
  let nearest = null
  let minDistance = Infinity

  tambons.forEach(tambon => {
    const distance = calculateDistance(lat, lng, tambon.lat, tambon.lng)
    if (distance < minDistance) {
      minDistance = distance
      nearest = { ...tambon, distance }
    }
  })

  return nearest
}

// Haversine formula
const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 6371
  const dLat = ((lat2 - lat1) * Math.PI) / 180
  const dLon = ((lon2 - lon1) * Math.PI) / 180
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2)
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
  return R * c
}

// จุดชายแดน (ด่านหาดเล็ก) - พิกัดด่านตรวจคนเข้าเมืองจริง
export const BORDER_POINT = { 
  lat: 11.6778, 
  lng: 102.9055, 
  name: "ด่านหาดเล็ก (จุดผ่านแดนถาวร)" 
}

export default TRAT_TAMBONS
